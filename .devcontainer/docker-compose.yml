version: '3.8'

services:
  # Verify that we are extending the root compose file
  # This service MUST match the name in the root docker-compose.yml to override it
  saint-graph:
    build:
      context: ..
      dockerfile: ai-tuber/.devcontainer/Dockerfile

    # We mount the workspace to a consistent location
    volumes:
      # Mount the entire repository to /workspaces/ai-tuber
      - ..:/workspaces/ai-tuber:cached
      # We still keep the original mounts if needed, but the user will likely work in /workspaces/ai-tuber
      # However, the original saint-graph mounted ./src/saint_graph:/app
      # To avoid confusion, we can let those persist or override them. 
      # By default, volumes are merged. 
      # Since we want to use the devcontainer as the main workspace, we rely on the workspaceFolder.

      # Keep the container running
    command: sleep infinity

    # Ensure environment variables are set for dev
    environment:
      - RUN_MODE=cli
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - PYTHONPATH=/workspaces/ai-tuber/src
  # We can also override mcp-cli to be part of the dev network or similar if needed
  # but strictly speaking, we just need saint-graph to be the dev container.
